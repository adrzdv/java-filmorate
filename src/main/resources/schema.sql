CREATE TABLE IF NOT EXISTS genre (
    id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name VARCHAR NOT NULL UNIQUE
);

CREATE TABLE IF NOT EXISTS mpa (
   id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
   name varchar NOT NULL UNIQUE
);

CREATE TABLE IF NOT EXISTS users (
 id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
 name varchar DEFAULT 'unknown',
 login varchar NOT NULL,
 email varchar NOT NULL,
 birthdate date,
 CONSTRAINT birth CHECK (birthdate < CURRENT_DATE)
);

CREATE TABLE IF NOT EXISTS films (
   id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
   title varchar NOT NULL,
   description varchar(200) NOT NULL,
   release_date date,
   duration INTEGER,
   mpa_rate INTEGER REFERENCES mpa(id) ON DELETE CASCADE,
   CONSTRAINT films_constraint CHECK (duration > 0 AND release_date > '1895-12-28')
);

CREATE TABLE IF NOT EXISTS films_genre (
 film_id INTEGER REFERENCES films(id) ON DELETE CASCADE,
 genre_id INTEGER REFERENCES genre(id) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS likes (
   film_id INTEGER REFERENCES films(id) ON DELETE CASCADE,
   user_id INTEGER REFERENCES users(id) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS friends (
   user_id INTEGER REFERENCES users(id) ON DELETE CASCADE,
   friend_id INTEGER,
   status varchar
);